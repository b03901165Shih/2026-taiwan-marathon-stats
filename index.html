<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å°åŒ—é¦¬æ‹‰æ¾åˆ†æå™¨</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI"; margin: 0; background: #f5f7fb; }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 24px; }
    h1 { margin-bottom: 4px; }
    h2 { margin-top: 32px; }
    .card { background: #fff; border-radius: 16px; padding: 20px 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.07); margin-top: 16px; }
    .row { display: flex; gap: 15px; flex-wrap: wrap; align-items: center; margin-bottom: 15px; }
    select, input { padding: 8px 15px; font-size: 17px; border-radius: 8px; border: 1px solid #d1d5db; min-width: 120px; }
    button { padding: 8px 16px; border-radius: 8px; border: none; background: #2563eb; color: #fff; cursor: pointer; font-size: 17px; }
    button:hover { background: #1d4ed8; }
    .label { font-size: 17px; color: #555; min-width: 70px; }
    #chartContainer { height: 400px; }
    canvas { max-width: 100%; max-height: 100%; }
    .result-block { margin-top: 15px; padding: 15px 17px; border-radius: 10px; background: #f9fafb; border: 1px solid #e5e7eb; }
    .result-title { font-weight: 600; margin-bottom: 6px; color: #111827; }
    .result-line { font-size: 16px; color: #374151; }
    .result-line span.value { font-weight: 600; color: #111827; }
    .time-input-group { display: flex; align-items: center; gap: 4px; }
    .time-input-group input { width: 60px; text-align: center; }
    .pr-time { font-size: 18px; font-weight: 700; color: #059669; margin: 8px 0; }
    /* ç¾è§€è¡¨æ ¼æ¨£å¼ */
    table { 
      font-size: 17px; 
      width: 100%; 
      border-collapse: separate; 
      border-spacing: 0;
      margin-top: 15px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    th, td { 
      padding: 10px 15px; 
      text-align: center; 
      border-bottom: 1px solid #e5e7eb; 
    }

    th { 
      font-weight: 600; 
      font-size: 1px; 
      color: #1f2937; 
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-bottom: 2px solid #e2e8f0;
    }

    td { 
      color: #374151; 
      background: #ffffff;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover { 
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%) !important;
      transform: scale(1.01);
      transition: all 0.2s ease;
    }

    td:nth-child(2), td:nth-child(3), td:nth-child(4), td:nth-child(5) {
      text-align: center; 
      font-weight: 500;
    }

    /* æ•¸å­—é«˜äº® */
    td:nth-child(4) { /* PR æ¬„ */
      color: #059669;
      font-weight: 600;
    }

  </style>
</head>
<body>
<div class="wrap">
  <h1>ğŸƒâ€â™‚ï¸ 2025 å°åŒ—é¦¬æ‹‰æ¾åˆ†æå™¨</h1>
  <div style="color:#6b7280;font-size:17px;">æˆç¸¾ä¾†æº: Bravelog. ä»¥å¤§æœƒæˆç¸¾(Official Time)ç‚ºæº–.</div>

  <!-- è³‡æ–™æ¨¡çµ„ -->
  <script src="marathon_bins_and_pr.js"></script>

  <!-- å€å¡Š 1ï¼šäº’å‹•å¼ histogram -->
  <h2>1. åˆ†çµ„å®Œè³½æ™‚é–“åˆ†å¸ƒ (histogram)</h2>
  <div class="card">
    <div class="row">
      <div class="label">è³½åˆ¥ï¼š</div>
      <select id="raceSelect"></select>

      <div class="label">åˆ†çµ„ï¼š</div>
      <select id="groupSelect"></select>

      <button id="btnDraw">æ›´æ–°åœ–è¡¨</button>
    </div>
    <div id="chartContainer">
      <canvas id="histCanvas"></canvas>
    </div>
  </div>

  <!-- å€å¡Š 2ï¼šè¼¸å…¥æ™‚é–“ â†’ æŸ¥ç¸½å ´ & æ€§åˆ¥ & ç´°éƒ¨åˆ†çµ„æ’å/PR -->
  <h2>2. è¼¸å…¥æ™‚é–“ï¼ŒæŸ¥ç¸½å ´ / æ€§åˆ¥ / åˆ†çµ„æ’å & PR</h2>
  <div class="card">
    <div class="row">
      <div class="label">è³½åˆ¥ï¼š</div>
      <select id="raceForPr">
        <option value="HM">HM (åŠé¦¬)</option>
        <option value="MA">MA (å…¨é¦¬)</option>
      </select>

      <div class="label">åˆ†çµ„é¡å‹ï¼š</div>
      <select id="groupForPr">
        <option value="ä¸€èˆ¬">ä¸€èˆ¬</option>
        <option value="è¦–éšœ">è¦–éšœ</option>
        <option value="è¼ªæ¤…">è¼ªæ¤…</option>
      </select>
    </div>

    <div class="row">
      <div class="label">å®Œè³½æ™‚é–“ï¼š</div>
      <div class="time-input-group">
        <input id="hInput" type="number" min="0" max="23" placeholder="HH"> :
        <input id="mInput" type="number" min="0" max="59" placeholder="MM"> :
        <input id="sInput" type="number" min="0" max="59" placeholder="SS">
      </div>
      <button id="btnCheckPr">æŸ¥è©¢æ’å / PR</button>
    </div>

    <div id="prResultArea"></div>
  </div>

  <!-- å€å¡Š 3ï¼šè¼¸å…¥ PR å€¼ â†’ æŸ¥å‰›å¥½è¶…è¶Šçš„æ™‚é–“ -->
  <h2>3. è¼¸å…¥ PR å€¼ï¼ŒæŸ¥å‰›å¥½è¶…è¶Šçš„æ™‚é–“</h2>
  <div class="card">
    <div class="row">
      <div class="label">è³½åˆ¥ï¼š</div>
      <select id="raceForPrReverse">
        <option value="HM">HM (åŠé¦¬)</option>
        <option value="MA">MA (å…¨é¦¬)</option>
      </select>

      <div class="label">åˆ†çµ„ï¼š</div>
      <select id="groupForPrReverse">
        <!-- å‹•æ…‹å¡«å…¥ ALL / å„ç´°åˆ†çµ„ -->
      </select>
    </div>

    <div class="row">
      <div class="label">PR å€¼ï¼š</div>
      <input id="prInput" type="number" min="0" max="100" step="0.1" placeholder="0 ~ 100">
      <button id="btnCheckPrReverse">æŸ¥è©¢å°æ‡‰æ™‚é–“</button>
    </div>

    <div id="prReverseResultArea"></div>
  </div>

</div>

<script>
  let groupsByRace = {}; // { HM: [...], MA: [...] }
  let histChart = null;

  // ---------- å°å·¥å…· ----------
  function classifyGroup(rawGroup) {
    const g = String(rawGroup);
    if (g.includes("è¼ªæ¤…")) return "è¼ªæ¤…";
    if (g.includes("è¦–éšœ")) return "è¦–éšœ";
    return "ä¸€èˆ¬";
  }

  function secondsToTime(sec) {
    sec = Math.floor(sec);
    const h = Math.floor(sec / 3600);
    const m = Math.floor((sec % 3600) / 60);
    const s = sec % 60;
    return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  }

  function timeToSeconds(h, m, s) {
    return h*3600 + m*60 + s;
  }

  function parseTimeInputs() {
    const h = parseInt(document.getElementById("hInput").value, 10);
    const m = parseInt(document.getElementById("mInput").value, 10);
    const s = parseInt(document.getElementById("sInput").value, 10);
    if (Number.isNaN(h) || Number.isNaN(m) || Number.isNaN(s)) {
      alert("è«‹è¼¸å…¥å®Œæ•´çš„ HH:MM:SS");
      return null;
    }
    if (h < 0 || h > 23 || m < 0 || m > 59 || s < 0 || s > 59) {
      alert("æ™‚é–“æ ¼å¼éŒ¯èª¤ï¼Œè«‹ç¢ºèªåœ¨ 00:00:00 ~ 23:59:59 ä¹‹é–“");
      return null;
    }
    return timeToSeconds(h, m, s);
  }

  // binary searchï¼šå·²æ’åºé™£åˆ— arr (ç”±å°åˆ°å¤§)ï¼Œå°‹æ‰¾ first index ä½¿å¾— arr[idx] >= target
  function lowerBound(arr, target) {
    let lo = 0, hi = arr.length;
    while (lo < hi) {
      const mid = (lo + hi) >> 1;
      if (arr[mid] < target) {
        lo = mid + 1;
      } else {
        hi = mid;
      }
    }
    return lo;
  }

  function buildGroupsByRace() {
    groupsByRace = {};
    for (const key of Object.keys(binsAndPr)) {
      const [race, group] = key.split("__");
      if (!groupsByRace[race]) groupsByRace[race] = new Set();
      groupsByRace[race].add(group);
    }
    for (const race of Object.keys(groupsByRace)) {
      const arr = Array.from(groupsByRace[race]);
      arr.sort((a,b) => {
        if (a === "ALL") return -1;
        if (b === "ALL") return 1;
        return a.localeCompare(b, "zh-Hant");
      });
      groupsByRace[race] = arr;
    }
  }

  function fillRaceAndGroupSelects() {
    const raceSelect = document.getElementById("raceSelect");
    raceSelect.innerHTML = "";
    const races = Object.keys(groupsByRace).sort();
    races.forEach(r => {
      const opt1 = document.createElement("option");
      opt1.value = r;
      opt1.textContent = r;
      raceSelect.appendChild(opt1);
    });
    if (races.length > 0) {
      updateGroupSelect(races[0]);
    }
  }

  function updateGroupSelect(race) {
    const groupSelect = document.getElementById("groupSelect");
    groupSelect.innerHTML = "";
    const groups = groupsByRace[race] || [];
    groups.forEach(g => {
      const opt = document.createElement("option");
      opt.value = g;
      opt.textContent = (g === "ALL") ? "ALL (æ‰€æœ‰äºº)" : g;
      groupSelect.appendChild(opt);
    });
  }

  // ---------- histogram ç¹ªåœ– ----------
  function drawHistogram() {
    const race = document.getElementById("raceSelect").value;
    const group = document.getElementById("groupSelect").value;
    const key = `${race}__${group}`;

    const obj = binsAndPr[key];
    if (!obj || !obj.histogram_5min) {
      alert("æ‰¾ä¸åˆ°å°æ‡‰è³‡æ–™ï¼š" + key);
      return;
    }
    const bins = obj.histogram_5min;

    const labels = bins.map(b => b.start_time);
    const counts = bins.map(b => b.count);

    const ctx = document.getElementById("histCanvas").getContext("2d");
    if (histChart) histChart.destroy();

    histChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels,
        datasets: [{
          label: `${race} / ${group}`,
          data: counts,
          backgroundColor: "rgba(37,99,235,0.75)",
          borderColor: "rgba(30,64,175,1)",
          borderWidth: 1,
          borderRadius: 4,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: true },
          tooltip: {
            callbacks: {
              label: (ctx) => {
                const i = ctx.dataIndex;
                const b = bins[i];
                return [
                  `äººæ•¸: ${b.count}`,
                  `å€é–“: ${b.start_time} ~ ${b.end_time}`
                ];
              }
            }
          }
        },
        scales: {
          x: {
            title: { display: true, text: "å®Œè³½æ™‚é–“ (5 åˆ†é˜å€é–“)" },
            ticks: { maxRotation: 45, minRotation: 45 }
          },
          y: {
            beginAtZero: true,
            title: { display: true, text: "äººæ•¸" }
          }
        }
      }
    });
  }

  // ---------- æŸ¥ç¸½å ´ & æ€§åˆ¥ & å„åˆ†çµ„æ’å / PR ----------

  function lookupPrForTime() {
    const sec = parseTimeInputs();
    if (sec == null) return;

    const race = document.getElementById("raceForPr").value;       // HM / MA
    const bucketType = document.getElementById("groupForPr").value; // ä¸€èˆ¬ / è¦–éšœ / è¼ªæ¤…
    const resultArea = document.getElementById("prResultArea");
    resultArea.innerHTML = "";

    // 1) å…¨å ´ HM__ALL / MA__ALL
    const allKey = `${race}__ALL`;
    const allObj = binsAndPr[allKey];

    if (!allObj || !allObj.sorted_seconds) {
      const warn = document.createElement("div");
      warn.className = "result-block";
      warn.textContent = `æ‰¾ä¸åˆ° ${allKey} çš„ sorted_secondsã€‚`;
      resultArea.appendChild(warn);
    } else {
      const allArr = allObj.sorted_seconds;
      const N_all = allArr.length;
      const idxAll = lowerBound(allArr, sec);
      const rankAll = idxAll + 1;
      const slowerAll = Math.max(N_all - rankAll);
      const prAll = (slowerAll / N_all * 100).toFixed(2);

      const blockAll = document.createElement("div");
      blockAll.className = "result-block";
      blockAll.innerHTML = `
        <div class="result-title">${race} / ALL (å…¨å ´)</div>
        <div class="result-line">ç¸½äººæ•¸ï¼š<span class="value">${N_all.toLocaleString()}</span></div>
        <div class="result-line">ä½ çš„æ™‚é–“ï¼š<span class="value">${secondsToTime(sec)}</span></div>
        <div class="result-line">ç¸½å ´æ’åï¼š<span class="value">${rankAll.toLocaleString()}</span></div>
        <div class="result-line">PR å€¼ï¼š<span class="value">${prAll}%</span>ï¼ˆè´é ${slowerAll.toLocaleString()} äººï¼‰</div>
      `;
      resultArea.appendChild(blockAll);
    }

    // 2) æ€§åˆ¥å½™ç¸½ (åœ¨ç›®å‰ bucketType ä¸­ï¼Œç”·/å¥³å„è‡ªåˆä½µ)
    const maleArr = [];
    const femaleArr = [];

    for (const key of Object.keys(binsAndPr)) {
      const [keyRace, rawGroup] = key.split("__");
      if (keyRace !== race) continue;
      if (rawGroup === "ALL") continue;
      if (classifyGroup(rawGroup) !== bucketType) continue;

      const obj = binsAndPr[key];
      if (!obj || !obj.sorted_seconds) continue;
      const g = String(rawGroup);
      if (g.includes("ç”·")) {
        maleArr.push(...obj.sorted_seconds);
      } else if (g.includes("å¥³")) {
        femaleArr.push(...obj.sorted_seconds);
      }
    }
    maleArr.sort((a,b)=>a-b);
    femaleArr.sort((a,b)=>a-b);

    if (maleArr.length > 0) {
      const N_m = maleArr.length;
      const idxM = lowerBound(maleArr, sec);
      const rankM = idxM + 1;
      const slowerM = Math.max(0, N_m - rankM);
      const prM = (slowerM / N_m * 100).toFixed(2);

      const blockM = document.createElement("div");
      blockM.className = "result-block";
      blockM.innerHTML = `
        <div class="result-title">${race} / ${bucketType} / ç”·æ€§åˆè¨ˆ</div>
        <div class="result-line">ç¸½äººæ•¸ï¼š<span class="value">${N_m.toLocaleString()}</span></div>
        <div class="result-line">æ’åï¼š<span class="value">${rankM.toLocaleString()}</span></div>
        <div class="result-line">PR å€¼ï¼š<span class="value">${prM}%</span>ï¼ˆè´é ${slowerM.toLocaleString()} äººï¼‰</div>
      `;
      resultArea.appendChild(blockM);
    }

    if (femaleArr.length > 0) {
      const N_f = femaleArr.length;
      const idxF = lowerBound(femaleArr, sec);
      const rankF = idxF + 1;
      const slowerF = Math.max(0, N_f - rankF);
      const prF = (slowerF / N_f * 100).toFixed(2);

      const blockF = document.createElement("div");
      blockF.className = "result-block";
      blockF.innerHTML = `
        <div class="result-title">${race} / ${bucketType} / å¥³æ€§åˆè¨ˆ</div>
        <div class="result-line">ç¸½äººæ•¸ï¼š<span class="value">${N_f.toLocaleString()}</span></div>
        <div class="result-line">æ’åï¼š<span class="value">${rankF.toLocaleString()}</span></div>
        <div class="result-line">PR å€¼ï¼š<span class="value">${prF}%</span>ï¼ˆè´é ${slowerF.toLocaleString()} äººï¼‰</div>
      `;
      resultArea.appendChild(blockF);
    }

    // 3) å„ç´°éƒ¨åˆ†çµ„è¡¨æ ¼
    const rows = [];
    for (const key of Object.keys(binsAndPr)) {
      const [keyRace, rawGroup] = key.split("__");
      if (keyRace !== race) continue;
      if (rawGroup === "ALL") continue;
      if (classifyGroup(rawGroup) !== bucketType) continue;

      const obj = binsAndPr[key];
      if (!obj || !obj.sorted_seconds) continue;

      const arr = obj.sorted_seconds;
      const N = arr.length;
      if (!N) continue;

      const idx = lowerBound(arr, sec);
      const rank = idx + 1;
      const slower = Math.max(0, N - rank);
      const pr = (slower / N * 100);

      rows.push({
        groupName: rawGroup,
        rank,
        total: N,
        pr,
        slower
      });
    }

    const listBlock = document.createElement("div");
    listBlock.className = "result-block";
    const header = document.createElement("div");
    header.className = "result-title";
    header.textContent = `${race} / ${bucketType} å„ç´°éƒ¨åˆ†çµ„`;
    listBlock.appendChild(header);
    console.log("Debug rows:", rows);  // çœ‹ console æœ‰æ²’æœ‰è³‡æ–™
    if (rows.length === 0) {
      const line = document.createElement("div");
      line.className = "result-line";
      line.textContent = "æ­¤è³½åˆ¥åœ¨é€™å€‹é¡å‹ä¸‹æ²’æœ‰ä»»ä½•åˆ†çµ„è³‡æ–™ã€‚";
      listBlock.appendChild(line);
    } else {
      // ä¾ PR é«˜â†’ä½æ’åˆ—
      rows.sort((a, b) => b.pr - a.pr);

      const table = document.createElement("table");
      table.style.width = "100%";
      table.style.borderCollapse = "collapse";
      table.style.fontSize = "17px";   // è¡¨æ ¼å­—é«”ç¨å¾®å¤§ä¸€é»

      table.innerHTML = `
        <thead>
          <tr>
            <th style="text-align:center;padding:4px 6px;border-bottom:1px solid #e5e7eb;font-size:18px;">åˆ†çµ„</th>
            <th style="text-align:center;padding:4px 6px;border-bottom:1px solid #e5e7eb;font-size:18px;">æ’å</th>
            <th style="text-align:center;padding:4px 6px;border-bottom:1px solid #e5e7eb;font-size:18px;">ç¸½äººæ•¸</th>
            <th style="text-align:center;padding:4px 6px;border-bottom:1px solid #e5e7eb;font-size:18px;">PR</th>
            <th style="text-align:center;padding:4px 6px;border-bottom:1px solid #e5e7eb;font-size:18px;">è´éäººæ•¸</th>
          </tr>
        </thead>
        <tbody></tbody>
      `;
      const tbody = table.querySelector("tbody");

      rows.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td style="padding:3px 6px;">${r.groupName}</td>
          <td style="padding:3px 6px;text-align:center;">${r.rank.toLocaleString()}</td>
          <td style="padding:3px 6px;text-align:center;">${r.total.toLocaleString()}</td>
          <td style="padding:3px 6px;text-align:center;">${r.pr.toFixed(2)}%</td>
          <td style="padding:3px 6px;text-align:center;">${r.slower.toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
      });

      listBlock.appendChild(table);
    }

    resultArea.appendChild(listBlock);
  }
  
  // æ–°å¢ï¼šå¡«å…¥ PR åæŸ¥çš„ä¸‹æ‹‰é¸å–®
  function fillPrReverseSelects() {
    const raceSelect = document.getElementById("raceForPrReverse");
    const groupSelect = document.getElementById("groupForPrReverse");

    const races = Object.keys(groupsByRace).sort();
    raceSelect.innerHTML = "";
    races.forEach(r => {
      const opt = document.createElement("option");
      opt.value = r;
      opt.textContent = r;
      raceSelect.appendChild(opt);
    });

    // é è¨­ç¬¬ä¸€å€‹ race + ALL
    if (races.length > 0) {
      const firstRace = races[0];
      updatePrReverseGroupSelect(firstRace);
    }
  }

  function updatePrReverseGroupSelect(race) {
    const groupSelect = document.getElementById("groupForPrReverse");
    groupSelect.innerHTML = "";
    const groups = groupsByRace[race] || [];
    groups.forEach(g => {
      const opt = document.createElement("option");
      opt.value = g;
      opt.textContent = (g === "ALL") ? "ALL (å…¨å ´)" : g;
      groupSelect.appendChild(opt);
    });
  }

  // PR åæŸ¥é‚è¼¯ï¼šè¼¸å…¥ PR% â†’ æ‰¾å‰›å¥½è¶…è¶Šçš„æ™‚é–“
  function lookupTimeForPr() {
    const prPct = parseFloat(document.getElementById("prInput").value);
    if (isNaN(prPct) || prPct < 0 || prPct > 100) {
      alert("è«‹è¼¸å…¥ 0 ~ 100 ä¹‹é–“çš„ PR å€¼");
      return;
    }

    const race = document.getElementById("raceForPrReverse").value;
    const group = document.getElementById("groupForPrReverse").value;
    const key = `${race}__${group}`;
    const resultArea = document.getElementById("prReverseResultArea");
    resultArea.innerHTML = "";

    const obj = binsAndPr[key];
    if (!obj || !obj.sorted_seconds) {
      const warn = document.createElement("div");
      warn.className = "result-block";
      warn.textContent = `æ‰¾ä¸åˆ° ${key} çš„ sorted_seconds`;
      resultArea.appendChild(warn);
      return;
    }

    const sortedSeconds = obj.sorted_seconds;
    const N = sortedSeconds.length;

    if (N === 0) {
      resultArea.innerHTML = `<div class="result-block">æ­¤çµ„åˆ¥ç„¡å®Œè³½è³‡æ–™</div>`;
      return;
    }

    // PR = (è´éäººæ•¸ / ç¸½äººæ•¸) * 100 â†’ è´éäººæ•¸ = PR * ç¸½äººæ•¸
    const slowerCount = Math.floor((prPct / 100) * N);
    const targetRank = N - slowerCount;  // 1-based æ’å

    if (targetRank > N) {
      // PR å¤ªå¤§ï¼Œæ²’äººèƒ½é”åˆ°
      const block = document.createElement("div");
      block.className = "result-block";
      block.innerHTML = `
        <div class="result-title">${key}</div>
        <div class="result-line">ç¸½äººæ•¸ï¼š<span class="value">${N.toLocaleString()}</span></div>
        <div class="pr-time">æ­¤ PR (${prPct}%) éœ€è¦ç¬¬ ${targetRank} åï¼Œä½†åªæœ‰ ${N} äººï¼Œç„¡æ³•é”æˆï¼</div>
        <div class="result-line">ğŸ† è«‹è·‘æ›´å¿«ï¼Œæ‹¿ ${key} ç¬¬ä¸€åï¼</div>
      `;
      resultArea.appendChild(block);
      return;
    }

    // æ‰¾åˆ°å‰›å¥½ç¬¬ targetRank åçš„æ™‚é–“ï¼ˆ1-based â†’ 0-based indexï¼‰
    const targetTimeSec = sortedSeconds[targetRank - 1];
    const targetTimeStr = secondsToTime(targetTimeSec);

    const block = document.createElement("div");
    block.className = "result-block";
    block.innerHTML = `
      <div class="result-title">${key}</div>
      <div class="result-line">ç¸½äººæ•¸ï¼š<span class="value">${N.toLocaleString()}</span></div>
      <div class="result-line">ç›®æ¨™æ’åï¼š<span class="value">${targetRank.toLocaleString()}</span> å</div>
      <div class="pr-time">â±ï¸ å‰›å¥½ ${prPct}% PR çš„æ™‚é–“ï¼š<span class="value">${targetTimeStr}</span></div>
      <div class="result-line">è´éï¼š<span class="value">${slowerCount.toLocaleString()}</span> äºº</div>
    `;
    resultArea.appendChild(block);
  }

  // ---------- åˆå§‹åŒ– ----------
  function init() {
    buildGroupsByRace();
    fillRaceAndGroupSelects();
    fillPrReverseSelects();
    drawHistogram();
  }

  // PR åæŸ¥äº‹ä»¶
  document.getElementById("raceForPrReverse").addEventListener("change", (e) => {
    updatePrReverseGroupSelect(e.target.value);
  });
  document.getElementById("btnCheckPrReverse").addEventListener("click", lookupTimeForPr);

  document.getElementById("raceSelect").addEventListener("change", (e) => {
    updateGroupSelect(e.target.value);
  });
  document.getElementById("btnDraw").addEventListener("click", drawHistogram);
  document.getElementById("btnCheckPr").addEventListener("click", lookupPrForTime);

  window.addEventListener("load", init);
</script>
</body>
</html>
